---
- name: git clone --depth 1 https://github.com/sstephenson/rbenv.git
  git:
    repo: 'https://github.com/sstephenson/rbenv.git'
    dest: "{{user_dir}}/.rbenv"
    depth: 1
  become_user: "{{user}}"

- name: git clone --depth 1 https://github.com/sstephenson/ruby-build.git
  git:
    repo: 'https://github.com/sstephenson/ruby-build.git'
    dest: "{{user_dir}}/.rbenv/plugins/ruby-build"
    depth: 1
  become_user: "{{user}}"


- name: set environment of ruby in .bashrc
  lineinfile:
    dest: "{{user_dir}}/.profile"
    line: "{{item}}"
  with_items:
    - 'export PATH="~/.rbenv/bin:$PATH"'
    - 'eval "$(rbenv init -)"'
  become_user: "{{user}}"

- name: source .bashrc
  shell: /bin/bash -lc "source {{user_dir}}/.profile"
  become_user: "{{user}}"

- name: rbenv install "{{version}}"
  shell: /bin/bash -lc "rbenv install {{version}}"
  ignore_errors: True
  become_user: "{{user}}"

- name: rbenv global "{{version}}"
  shell: /bin/bash -lc "rbenv global {{version}}"
  become_user: "{{user}}"

