---
- name: Download bash
  get_url:
    url: "http://ftp.gnu.org/gnu/bash/bash-{{version}}.tar.gz"
    dest: "{{ src_dir }}"

- name: Download the patches
  get_url:
    url: "http://ftp.gnu.org/gnu/bash/bash-{{version}}-patches/{{item.version}}"
    dest: "{{ src_dir }}/{{ item.name }}"
  with_items: "{{ patches }}"

- name: Unarchive bash
  unarchive:
    src: "{{ src_dir }}/bash-{{ version }}.tar.gz"
    dest: "{{ src_dir }}"
    copy: no

- name: Execute the patches
  shell: bash -lc "patch -p0 < {{ src_dir }}/{{ item.name }} "
  args:
    chdir: "{{ src_dir }}/bash-{{ version }}"
  with_items: "{{ patches }}"

- name: ./configure
  shell: bash -lc "{{ configure_command }}"
  args:
    chdir: "{{ src_dir }}/bash-{{ version }}"

- name: make
  shell: bash -lc "make"
  args:
    chdir: "{{ src_dir }}/bash-{{ version }}"

- name: make install
  shell: bash -lc "make install"
  args:
    chdir: "{{ src_dir }}/bash-{{ version }}"

- name: Add /usr/local/bin/bash in /etc/shells
  lineinfile:
    dest: /etc/shells
    line: /usr/local/bin/bash
